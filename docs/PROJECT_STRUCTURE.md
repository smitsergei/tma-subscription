# üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ TMA-Subscription

## üéØ –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- **–û—Å–Ω–æ–≤–Ω–æ–π webhook:** `/api/webhook/route.ts` ‚úÖ
- **–£–¥–∞–ª–µ–Ω –¥—É–±–ª–∏—Ä—É—é—â–∏–π webhook:** `/api/telegram/webhook/route.ts` ‚ùå
- **Telegram Bot URL:** `https://tma-subscription.vercel.app/api/webhook`

## üì± API Endpoints

### –û—Å–Ω–æ–≤–Ω—ã–µ API
- `/api/products` - –ü—É–±–ª–∏—á–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
- `/api/user/subscriptions` - –ü–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `/api/payment/initiate` - –ò–Ω–∏—Ü–∏–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–∞
- `/api/payment/verify` - –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–∞
- `/api/webhook` - **–û—Å–Ω–æ–≤–Ω–æ–π webhook Telegram –±–æ—Ç–∞**

### –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- `/api/admin/auth` - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- `/api/admin/stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `/api/admin/products` - **–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ v2**
- `/api/admin/products-v2` - **–û—Å–Ω–æ–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π BigInt**
- `/api/admin/subscriptions` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏
- `/api/admin/users` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- `/api/admin/promocodes` - –ü—Ä–æ–º–æ–∫–æ–¥—ã
- `/api/admin/discounts` - –°–∫–∏–¥–∫–∏

### –î–µ–º–æ-—Ñ—É–Ω–∫—Ü–∏–∏
- `/api/admin/demo/*` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–µ–º–æ-–¥–æ—Å—Ç—É–ø–æ–º

### ‚ö†Ô∏è –í—Ä–µ–º–µ–Ω–Ω—ã–µ/–æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É–¥–∞–ª–∏—Ç—å)
- `/api/test-webhook` - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ webhook
- `/api/debug-webhook` - –û—Ç–ª–∞–¥–∫–∞ webhook
- `/api/debug/*` - –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- `/api/admin/test-env` - –¢–µ—Å—Ç environment
- `/api/admin/fix-*` - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
- `/api/admin/get-link` - –í—Ä–µ–º–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è

## üõ† –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
- `/start` - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å –∫–Ω–æ–ø–∫–æ–π üöÄ –û—Ç–∫—Ä—ã—Ç—å Mini App
- `/help` - –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- `/mysubscriptions` - –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `/test` - –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
- `/admin` - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)

## üé® Frontend —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- `/` - –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–ª–µ–Ω–¥–∏–Ω–≥)
- `/app` - Mini App –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `/admin` - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

## üóÉ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **PostgreSQL —á–µ—Ä–µ–∑ Neon**
- **Prisma ORM** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π
- **–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:** users, admins, channels, products, subscriptions

## üîß Environment Variables
- `BOT_TOKEN` - –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞
- `APP_URL` - URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (production: https://tma-subscription.vercel.app)
- `NEXT_PUBLIC_APP_URL` - –ü—É–±–ª–∏—á–Ω—ã–π URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `DATABASE_URL` - –°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL
- `ADMIN_TELEGRAM_ID` - ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ Telegram

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ—á–∏—Å—Ç–∫–µ

### –ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å (–ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏):
```
app/api/test-webhook/
app/api/debug-webhook/
app/api/debug/
app/api/admin/test-env/
app/api/admin/fix-bigint/
app/api/admin/fix-webhook/
app/api/admin/fix-webhook-alias/
app/api/admin/get-link/
app/api/catch-errors/
```

### –ó–∞–º–µ–Ω–∏—Ç—å:
```
app/api/admin/products/ ‚Üí app/api/admin/products-v2/
```

## üéØ –†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** –Ω–∞–∂–∏–º–∞–µ—Ç `/start` –≤ Telegram
2. **Webhook** `/api/webhook` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É
3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** –≤–∏–¥–∏—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∫–Ω–æ–ø–∫—É üöÄ –û—Ç–∫—Ä—ã—Ç—å Mini App
4. **Mini App** –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ URL `/app`
5. **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä** –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –ø–æ `/admin`

## ‚úÖ –°—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ —á–∏—Å—Ç–∫–∏

- [x] –£–¥–∞–ª–µ–Ω –¥—É–±–ª–∏—Ä—É—é—â–∏–π webhook
- [x] –û—Å–Ω–æ–≤–Ω–æ–π webhook —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- [x] –í—Å–µ –∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [x] URL –∏—Å–ø–æ–ª—å–∑—É—é—Ç environment –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
- [ ] –ù—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- [ ] –ù—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å products –Ω–∞ products-v2