# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã

## ‚öôÔ∏è –î–µ—Ç–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

–ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ç–æ–Ω–∫—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã.

---

## ü§ñ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Telegram –±–æ—Ç–∞

### üìù –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥
curl -X POST "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/setMyCommands" \
  -H "Content-Type: application/json" \
  -d '{
    "commands": [
      {"command": "start", "description": "üöÄ –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É"},
      {"command": "subscriptions", "description": "üì± –ú–æ–∏ –ø–æ–¥–ø–∏—Å–∫–∏"},
      {"command": "products", "description": "üõçÔ∏è –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã"},
      {"command": "balance", "description": "üí∞ –ú–æ–π –±–∞–ª–∞–Ω—Å"},
      {"command": "support", "description": "üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞"},
      {"command": "help", "description": "‚ùì –ü–æ–º–æ—â—å"}
    ]
  }'
```

### üé® –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–ø–∏—Å–∞–Ω–∏—è –±–æ—Ç–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–ø–∏—Å–∞–Ω–∏—è –±–æ—Ç–∞
curl -X POST "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/setDescription" \
  -d "description=üöÄ –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –ø–æ–¥–ø–∏—Å–æ–∫ –Ω–∞ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç. –û–ø–ª–∞—á–∏–≤–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ TON Connect –∏ –ø–æ–ª—É—á–∞–π—Ç–µ –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∑–∞–∫—Ä—ã—Ç—ã–º –∫–∞–Ω–∞–ª–∞–º."
```

### üñºÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Mini App

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `public/manifest.json`:

```json
{
  "name": "TMA –ü–æ–¥–ø–∏—Å–∫–∞",
  "short_name": "–ü–æ–¥–ø–∏—Å–∫–∞",
  "description": "–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ –Ω–∞ Telegram-–∫–∞–Ω–∞–ª—ã",
  "start_url": "/app",
  "display": "standalone",
  "background_color": "#1a1a1a",
  "theme_color": "#0088cc",
  "icons": [
    {
      "src": "/icon-192.png",
      "sizes": "192x192",
      "type": "image/png"
    },
    {
      "src": "/icon-512.png",
      "sizes": "512x512",
      "type": "image/png"
    }
  ]
}
```

---

## üí≥ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã

### üöÄ TON Connect –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

#### üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∫–æ—à–µ–ª—å–∫—É
```typescript
// lib/ton/config.ts
export const TON_CONFIG = {
  // –ê–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ USDT –∫–æ—à–µ–ª—å–∫–∞
  walletAddress: process.env.TON_WALLET_ADDRESS!,

  // –°–µ—Ç—å: TESTNET –∏–ª–∏ MAINNET
  network: process.env.NODE_ENV === 'development' ? 'TESTNET' : 'MAINNET',

  // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞
  minPayment: '1', // 1 USDT

  // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞
  maxPayment: '10000', // 10000 USDT

  // –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–≤ –º–∏–Ω—É—Ç–∞—Ö)
  transactionTimeout: 30,

  // USDT –∫–æ–Ω—Ç—Ä–∞–∫—Ç –∞–¥—Ä–µ—Å (–¥–ª—è MAINNET)
  usdtContractAddress: 'EQCxE6mUtQJKFnGfaROTKOt1lZbDiiX1kCixRv7Nw2Id_sDs',

  // USDT –∫–æ–Ω—Ç—Ä–∞–∫—Ç –∞–¥—Ä–µ—Å (–¥–ª—è TESTNET)
  testnetUsdtContractAddress: 'EQB2cq_n7iOTlW1wqjD6kz3r6hF5iXaJ9m6Gz1Y2X3Z4A5B6C'
};
```

#### ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Toncenter API

```typescript
// lib/ton/toncenter.ts
export const TONCENTER_CONFIG = {
  apiKey: process.env.TONCENTER_API_KEY!,

  // –ë–∞–∑–æ–≤—ã–π URL API
  baseUrl: process.env.NODE_ENV === 'development'
    ? 'https://testnet.toncenter.com/api/v3'
    : 'https://toncenter.com/api/v3',

  // –õ–∏–º–∏—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤
  rateLimit: {
    requestsPerSecond: 1,
    requestsPerMinute: 60
  },

  // –¢–∞–π–º–∞—É—Ç—ã
  timeout: 30000, // 30 —Å–µ–∫—É–Ω–¥

  // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –ø—Ä–∏ –æ—à–∏–±–∫–µ
  retryAttempts: 3,

  // –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
  retryDelay: 1000 // 1 —Å–µ–∫—É–Ω–¥–∞
};
```

### üí∞ NOWPayments –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```typescript
// lib/payments/nowpayments.ts
export const NOWPAYMENTS_CONFIG = {
  apiKey: process.env.NOWPAYMENTS_API_KEY!,

  // IPN —Å–µ–∫—Ä–µ—Ç –¥–ª—è –≤–µ–±—Ö—É–∫–æ–≤
  ipnSecret: process.env.NOWPAYMENTS_IPN_SECRET!,

  // –ë–∞–∑–æ–≤—ã–π URL API
  baseUrl: 'https://api.nowpayments.io/v1',

  // –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã
  supportedCurrencies: ['BTC', 'ETH', 'LTC', 'USDT', 'USDC'],

  // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Å—É–º–º—ã –ø–æ –≤–∞–ª—é—Ç–∞–º
  minAmounts: {
    'BTC': 0.0001,
    'ETH': 0.01,
    'LTC': 0.01,
    'USDT': 10,
    'USDC': 10
  },

  // –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –ø–ª–∞—Ç–µ–∂–∞ (–≤ –º–∏–Ω—É—Ç–∞—Ö)
  paymentLifetime: 60,

  // –ö–æ–º–∏—Å—Å–∏—è —Å–µ—Ä–≤–∏—Å–∞
  serviceFee: 0.005 // 0.5%
};
```

---

## üóÑÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### üîß –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Prisma

```prisma
// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_URL")
}

// –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
// –í vercel.json:
{
  "functions": {
    "app/api/**/*.ts": {
      "maxDuration": 30
    }
  }
}
```

### üìä –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω–¥–µ–∫—Å–æ–≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```sql
-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–¥–ø–∏—Å–æ–∫
CREATE INDEX idx_subscriptions_user_id ON subscriptions(user_id);
CREATE INDEX idx_subscriptions_status ON subscriptions(status);
CREATE INDEX idx_subscriptions_expires_at ON subscriptions(expires_at);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π
CREATE INDEX idx_payments_user_id ON payments(user_id);
CREATE INDEX idx_payments_status ON payments(status);
CREATE INDEX idx_payments_created_at ON payments(created_at);
CREATE INDEX idx_payments_tx_hash ON payments(tx_hash);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤
CREATE INDEX idx_products_channel_id ON products(channel_id);
CREATE INDEX idx_products_is_active ON products(is_active);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
CREATE INDEX idx_users_telegram_id ON users(telegram_id);
CREATE INDEX idx_users_username ON users(username);

-- –°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
CREATE INDEX idx_subscriptions_user_status ON subscriptions(user_id, status);
CREATE INDEX idx_payments_user_status ON payments(user_id, status);
```

### üîÑ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—É–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

```typescript
// lib/db/prisma.ts
import { PrismaClient } from '@prisma/client';

const globalForPrisma = globalThis as unknown as {
  prisma: PrismaClient | undefined;
};

export const prisma =
  globalForPrisma.prisma ??
  new PrismaClient({
    datasources: {
      db: {
        url: process.env.POSTGRES_URL,
      },
    },
    // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è serverless
    log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ connection pool
    __internal: {
      engine: {
        connectionLimit: 10,
        poolTimeout: 10000,
      },
    },
  });

if (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;
```

---

## üìß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### ü§ñ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

```typescript
// lib/notifications/telegram.ts
export const TELEGRAM_NOTIFICATIONS = {
  // –®–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π
  templates: {
    welcome: `üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!\n\n–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ {product_name}.\n–î–æ—Å—Ç—É–ø –¥–æ: {expiry_date}`,
    paymentReceived: `‚úÖ –ü–ª–∞—Ç–µ–∂ –ø–æ–ª—É—á–µ–Ω!\n\n–°—É–º–º–∞: {amount} {currency}\n–ü—Ä–æ–¥—É–∫—Ç: {product_name}`,
    subscriptionExpiring: `‚è∞ –ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–∞–µ—Ç!\n\n–í–∞—à–∞ –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ {product_name} –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ {days_left} –¥–Ω–µ–π.\n–ü—Ä–æ–¥–ª–∏—Ç–µ –¥–æ—Å—Ç—É–ø: {renewal_link}`,
    subscriptionExpired: `üîí –ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞!\n\n–î–æ—Å—Ç—É–ø –∫ {product_name} –ø—Ä–µ–∫—Ä–∞—â–µ–Ω.\n–ü—Ä–æ–¥–ª–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É: {renewal_link}`,
    paymentFailed: `‚ùå –ü–ª–∞—Ç–µ–∂ –Ω–µ –ø—Ä–æ—à–µ–ª!\n\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞ –∏–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π.`,
    newPurchase: `üéä –ù–æ–≤–∞—è –ø–æ–∫—É–ø–∫–∞!\n\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: @{username}\n–ü—Ä–æ–¥—É–∫—Ç: {product_name}\n–°—É–º–º–∞: {amount} {currency}`
  },

  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
  settings: {
    rateLimit: {
      messagesPerSecond: 30,
      messagesPerMinute: 1000
    },

    retryAttempts: 3,
    retryDelay: 1000,

    // –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Å–æ–æ–±—â–µ–Ω–∏—è (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
    messageTTL: 86400, // 24 —á–∞—Å–∞

    // –†–∞–∑—Ä–µ—à–∏—Ç—å —Ä–∞–∑–º–µ—Ç–∫—É
    allowMarkdown: true,
    allowHTML: false
  }
};
```

### üìß Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```typescript
// lib/notifications/email.ts
export const EMAIL_NOTIFICATIONS = {
  provider: 'resend', // –∏–ª–∏ 'sendgrid', 'aws-ses'

  apiKey: process.env.EMAIL_SERVICE_API_KEY!,

  fromEmail: 'noreply@yourdomain.com',
  fromName: 'TMA –ü–æ–¥–ø–∏—Å–∫–∞',

  templates: {
    welcome: {
      subject: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É –ø–æ–¥–ø–∏—Å–æ–∫!',
      template: 'welcome-email.html'
    },
    paymentReceived: {
      subject: '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞',
      template: 'payment-confirmation.html'
    },
    subscriptionExpiring: {
      subject: '–í–∞—à–∞ –ø–æ–¥–ø–∏—Å–∫–∞ —Å–∫–æ—Ä–æ –∏—Å—Ç–µ—á–µ—Ç',
      template: 'subscription-expiring.html'
    }
  },

  settings: {
    rateLimit: {
      emailsPerMinute: 100
    },

    retryAttempts: 3,
    retryDelay: 5000
  }
};
```

---

## üîí –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### üõ°Ô∏è Rate Limiting

```typescript
// lib/security/rateLimit.ts
export const RATE_LIMIT_CONFIG = {
  // API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
  '/api/payment/initiate': {
    windowMs: 15 * 60 * 1000, // 15 –º–∏–Ω—É—Ç
    max: 5, // –º–∞–∫—Å–∏–º—É–º 5 –∑–∞–ø—Ä–æ—Å–æ–≤
    message: '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫ –æ–ø–ª–∞—Ç—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.'
  },

  '/api/admin/*': {
    windowMs: 15 * 60 * 1000, // 15 –º–∏–Ω—É—Ç
    max: 100, // –º–∞–∫—Å–∏–º—É–º 100 –∑–∞–ø—Ä–æ—Å–æ–≤
    message: '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏.'
  },

  '/api/auth/*': {
    windowMs: 60 * 60 * 1000, // 1 —á–∞—Å
    max: 10, // –º–∞–∫—Å–∏–º—É–º 10 –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
    message: '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.'
  },

  // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  global: {
    windowMs: 15 * 60 * 1000, // 15 –º–∏–Ω—É—Ç
    max: 1000, // –º–∞–∫—Å–∏–º—É–º 1000 –∑–∞–ø—Ä–æ—Å–æ–≤ —Å IP
    message: '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.'
  }
};
```

### üîê CORS –∏ CSP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```typescript
// next.config.js
const nextConfig = {
  async headers() {
    return [
      {
        source: '/api/:path*',
        headers: [
          {
            key: 'Access-Control-Allow-Origin',
            value: process.env.NODE_ENV === 'development' ? '*' : 'https://t.me',
          },
          {
            key: 'Access-Control-Allow-Methods',
            value: 'GET, POST, PUT, DELETE, OPTIONS',
          },
          {
            key: 'Access-Control-Allow-Headers',
            value: 'Content-Type, Authorization',
          },
        ],
      },
      {
        source: '/(.*)',
        headers: [
          {
            key: 'Content-Security-Policy',
            value: [
              "default-src 'self'",
              "script-src 'self' 'unsafe-eval' 'unsafe-inline'",
              "style-src 'self' 'unsafe-inline'",
              "img-src 'self' data: https:",
              "connect-src 'self' https://toncenter.com https://api.nowpayments.io"
            ].join('; '),
          },
        ],
      },
    ];
  },
};
```

---

## üìä –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

### üìà Vercel Analytics

```typescript
// lib/analytics/vercel.ts
import { getAnalytics } from '@vercel/analytics/server';

export const analyticsConfig = {
  // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π
  events: {
    payment_initiated: 'payment_initiated',
    payment_completed: 'payment_completed',
    payment_failed: 'payment_failed',
    subscription_created: 'subscription_created',
    subscription_expired: 'subscription_expired',
    user_registered: 'user_registered',
    product_viewed: 'product_viewed'
  },

  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏
  privacy: {
    maskIP: true,
    maskUserAgent: true,
    respectDoNotTrack: true
  }
};
```

### üìä –ö–∞—Å—Ç–æ–º–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

```typescript
// lib/analytics/custom.ts
export const customAnalytics = {
  // –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
  metrics: {
    dailyRevenue: 'daily_revenue',
    activeSubscriptions: 'active_subscriptions',
    conversionRate: 'conversion_rate',
    averageOrderValue: 'average_order_value',
    churnRate: 'churn_rate',
    userLifetimeValue: 'user_lifetime_value'
  },

  // –î–∞—à–±–æ—Ä–¥—ã
  dashboards: {
    overview: '–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞',
    revenue: '–î–æ—Ö–æ–¥—ã',
    users: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏',
    products: '–ü—Ä–æ–¥—É–∫—Ç—ã',
    performance: '–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å'
  },

  // –ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
  aggregation: {
    intervals: ['hour', 'day', 'week', 'month'],
    retention: 30 // –¥–Ω–µ–π
  }
};
```

---

## üé® –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è UI/UX

### üé® –¢–µ–º—ã –∏ –±—Ä–µ–Ω–¥–∏–Ω–≥

```typescript
// lib/ui/theme.ts
export const themeConfig = {
  // –û—Å–Ω–æ–≤–Ω—ã–µ —Ü–≤–µ—Ç–∞
  colors: {
    primary: '#0088cc',
    secondary: '#1a1a1a',
    accent: '#00a86b',
    error: '#dc3545',
    warning: '#ffc107',
    success: '#28a745',

    // –¶–≤–µ—Ç–∞ –¥–ª—è Telegram
    telegramBlue: '#0088cc',
    telegramDark: '#1a1a1a',
    telegramLight: '#f8f9fa'
  },

  // –¢–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞
  typography: {
    fontFamily: {
      sans: ['Inter', 'system-ui', 'sans-serif'],
      mono: ['JetBrains Mono', 'monospace']
    },
    fontSize: {
      xs: ['0.75rem', { lineHeight: '1rem' }],
      sm: ['0.875rem', { lineHeight: '1.25rem' }],
      base: ['1rem', { lineHeight: '1.5rem' }],
      lg: ['1.125rem', { lineHeight: '1.75rem' }],
      xl: ['1.25rem', { lineHeight: '1.75rem' }]
    }
  },

  // –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å
  breakpoints: {
    sm: '640px',
    md: '768px',
    lg: '1024px',
    xl: '1280px'
  }
};
```

### üåç –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å

```typescript
// lib/i18n/config.ts
export const i18nConfig = {
  // –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —è–∑—ã–∫–∏
  locales: ['ru', 'en', 'es', 'de', 'fr'],

  // –Ø–∑—ã–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  defaultLocale: 'ru',

  // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  localeDetection: [
    'url', // –∏–∑ URL /en/page
    'cookie', // –∏–∑ cookie
    'header', // –∏–∑ Accept-Language header
    'userProfile' // –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  ],

  // –ü–µ—Ä–µ–≤–æ–¥—ã –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
  translations: {
    ru: {
      'common.subscribe': '–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è',
      'common.price': '–¶–µ–Ω–∞',
      'common.duration': '–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å',
      'payment.processing': '–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞...',
      'payment.success': '–ü–ª–∞—Ç–µ–∂ —É—Å–ø–µ—à–Ω—ã–π!',
      'payment.failed': '–ü–ª–∞—Ç–µ–∂ –Ω–µ –ø—Ä–æ—à–µ–ª'
    },
    en: {
      'common.subscribe': 'Subscribe',
      'common.price': 'Price',
      'common.duration': 'Duration',
      'payment.processing': 'Processing payment...',
      'payment.success': 'Payment successful!',
      'payment.failed': 'Payment failed'
    }
    // ... –¥—Ä—É–≥–∏–µ —è–∑—ã–∫–∏
  }
};
```

---

## üöÄ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### ‚ö° –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

```typescript
// lib/cache/config.ts
export const cacheConfig = {
  // Redis –∫—ç—à
  redis: {
    ttl: {
      user: 3600, // 1 —á–∞—Å
      products: 1800, // 30 –º–∏–Ω—É—Ç
      payments: 300, // 5 –º–∏–Ω—É—Ç
      subscriptions: 600 // 10 –º–∏–Ω—É—Ç
    },

    // –ö–ª—é—á–∏ –∫—ç—à–∞
    keys: {
      user: (telegramId: number) => `user:${telegramId}`,
      products: () => 'products:all',
      activePayments: (userId: number) => `payments:active:${userId}`,
      userSubscriptions: (userId: number) => `subscriptions:${userId}`
    }
  },

  // HTTP –∫—ç—à
  http: {
    // –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
    static: {
      maxAge: 31536000, // 1 –≥–æ–¥
      immutable: true
    },

    // API –æ—Ç–≤–µ—Ç—ã
    api: {
      products: 'public, max-age=300', // 5 –º–∏–Ω—É—Ç
      userProfile: 'private, max-age=60', // 1 –º–∏–Ω—É—Ç–∞
      stats: 'private, max-age=300' // 5 –º–∏–Ω—É—Ç
    }
  }
};
```

### üì¶ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–±–æ—Ä–∫–∏

```javascript
// next.config.js
const nextConfig = {
  // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
  images: {
    domains: ['your-domain.com'],
    formats: ['image/webp', 'image/avif'],
    deviceSizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840],
    imageSizes: [16, 32, 48, 64, 96, 128, 256, 384]
  },

  // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —à—Ä–∏—Ñ—Ç–æ–≤
  optimizeFonts: true,

  // –ö–æ–º–ø—Ä–µ—Å—Å–∏—è
  compress: true,

  // SWC –º–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è
  swcMinify: true,

  // –ü–µ—Ä–µ–∑–∞–ø–∏—Å—å URL –¥–ª—è API
  async rewrites() {
    return [
      {
        source: '/api/health',
        destination: '/api/health',
      },
    ];
  },

  // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
  env: {
    NEXT_PUBLIC_APP_URL: process.env.NEXT_PUBLIC_APP_URL,
    NEXT_PUBLIC_TON_NETWORK: process.env.NODE_ENV === 'development' ? 'TESTNET' : 'MAINNET'
  }
};
```

---

## üì± –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏

### üì≤ PWA –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```json
// public/manifest.json
{
  "name": "TMA –ü–æ–¥–ø–∏—Å–∫–∞",
  "short_name": "–ü–æ–¥–ø–∏—Å–∫–∞",
  "description": "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ –Ω–∞ Telegram –∫–∞–Ω–∞–ª—ã",
  "start_url": "/app?utm_source=pwa",
  "display": "standalone",
  "background_color": "#1a1a1a",
  "theme_color": "#0088cc",
  "orientation": "portrait",
  "scope": "/",
  "categories": ["finance", "productivity"],
  "lang": "ru",
  "icons": [
    {
      "src": "/icon-72.png",
      "sizes": "72x72",
      "type": "image/png"
    },
    {
      "src": "/icon-96.png",
      "sizes": "96x96",
      "type": "image/png"
    },
    {
      "src": "/icon-128.png",
      "sizes": "128x128",
      "type": "image/png"
    },
    {
      "src": "/icon-144.png",
      "sizes": "144x144",
      "type": "image/png"
    },
    {
      "src": "/icon-152.png",
      "sizes": "152x152",
      "type": "image/png"
    },
    {
      "src": "/icon-192.png",
      "sizes": "192x192",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icon-384.png",
      "sizes": "384x384",
      "type": "image/png"
    },
    {
      "src": "/icon-512.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "any maskable"
    }
  ],
  "shortcuts": [
    {
      "name": "–ú–æ–∏ –ø–æ–¥–ø–∏—Å–∫–∏",
      "short_name": "–ü–æ–¥–ø–∏—Å–∫–∏",
      "description": "–ü—Ä–æ—Å–º–æ—Ç—Ä –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫",
      "url": "/app/subscriptions",
      "icons": [
        {
          "src": "/icon-96.png",
          "sizes": "96x96"
        }
      ]
    }
  ]
}
```

---

## üéØ –ß–µ–∫-–ª–∏—Å—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- [ ] **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã
- [ ] **Telegram –±–æ—Ç** –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å –∫–æ–º–∞–Ω–¥–∞–º–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ–º
- [ ] **TON –∫–æ—à–µ–ª–µ–∫** –ø–æ–¥–∫–ª—é—á–µ–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- [ ] **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏
- [ ] **Cron jobs** –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä** –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Å–∏—Å—Ç–µ–º—É
- [ ] **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ (rate limiting, CORS)

### üîß –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- [ ] **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- [ ] **Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- [ ] **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
- [ ] **PWA** —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] **–ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å** –¥–æ–±–∞–≤–ª–µ–Ω–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- [ ] **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –æ—à–∏–±–æ–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] **–ë—ç–∫–∞–ø—ã** –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

### üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

- [ ] **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è** –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∏ –≤ WebP
- [ ] **–®—Ä–∏—Ñ—Ç—ã** –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∏ preloaded
- [ ] **API** –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω—ã –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
- [ ] **CDN** –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
- [ ] **Lazy loading** –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- [ ] **Code splitting** –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

## üÜò –ü–æ–∏—Å–∫ –ø—Ä–æ–±–ª–µ–º

### üîß –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

#### –û—à–∏–±–∫–∞: "TON Connect –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ TON_WALLET_ADDRESS –∏ TONCENTER_API_KEY

#### –û—à–∏–±–∫–∞: "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –º–µ–¥–ª–µ–Ω–Ω–∞—è"
**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤—å—Ç–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ connection pool

#### –û—à–∏–±–∫–∞: "Cron jobs –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è"
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Vercel

#### –û—à–∏–±–∫–∞: "UI –º–µ–¥–ª–µ–Ω–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è"
**–†–µ—à–µ–Ω–∏–µ**: –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –≤–∫–ª—é—á–∏—Ç–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

---

**–ì–æ—Ç–æ–≤–æ! üéâ –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ.**

[üì° API —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫](./api-reference.md) | [üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](./database.md)