# üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–∏ –≤ webhook

## üö® –ü—Ä–æ–±–ª–µ–º–∞
**–°–∏–º–ø—Ç–æ–º—ã:**
- –ü–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã `/mysubscriptions` –¥—Ä—É–≥–∏–µ –∫–æ–º–∞–Ω–¥—ã –ø–µ—Ä–µ—Å—Ç–∞–≤–∞–ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å
- –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤–≤–æ–¥–µ `/start` –ø—Ä–∏—Ö–æ–¥–∏–ª–æ —Å–æ–æ–±—â–µ–Ω–∏–µ "–£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫"
- –ë–æ—Ç "–∑–∞—Å—Ç—Ä–µ–≤–∞–ª" –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### –ö–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã
–í –∫–æ–¥–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥—ã `/mysubscriptions` –±—ã–ª –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω—ã–π `return`:

```typescript
// –ë—ã–ª–æ (–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
if (subscriptions.length === 0) {
  await sendMessage(chatId, '...')
  responseSent = true
  return  // ‚Üê –ü—Ä–æ–±–ª–µ–º–∞! –í—ã—Ö–æ–¥ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç `/mysubscriptions`
2. –ù–∞—Ö–æ–¥–∏—Ç—Å—è `return` –≤ —Å—Ç—Ä–æ–∫–µ 227
3. –§—É–Ω–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è, –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—è –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
4. `responseSent` –æ—Å—Ç–∞–µ—Ç—Å—è `true` –¥–ª—è –≤—Å–µ—Ö –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è
- –ü–æ—Å–ª–µ `/mysubscriptions` –¥—Ä—É–≥–∏–µ –∫–æ–º–∞–Ω–¥—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å
- –ë–æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–ª –¥—É–º–∞—Ç—å, —á—Ç–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â—É—é –∫–æ–º–∞–Ω–¥—É
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–ª –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥:
```typescript
// –°—Ç–∞–ª–æ (–ü—Ä–∞–≤–∏–ª—å–Ω–æ):
if (subscriptions.length === 0) {
  await sendMessage(chatId, '...')
  responseSent = true
  // –£–±—Ä–∞–ª–∏ return!
}
```

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**
- –£–±—Ä–∞–Ω –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω—ã–π `return`
- –ö–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ `/mysubscriptions`
- –í—Å–µ –∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
```bash
# –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫–æ–º–∞–Ω–¥:
/start        ‚úÖ
/mysubscriptions ‚úÖ
/start        ‚úÖ
/help         ‚úÖ
/start        ‚úÖ
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ –∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### Production —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- **URL:** https://tma-subscription.vercel.app ‚úÖ
- **Webhook:** https://tma-subscription.vercel.app/api/webhook ‚úÖ
- **–°—Ç–∞—Ç—É—Å:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ

## üìä –õ–æ–≥–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥

```
üí¨ Processing message: { chatId: 123456, text: '/start' }
üí¨ Processing message: { chatId: 123456, text: '/mysubscriptions' }
üí¨ Processing message: { chatId: 123456, text: '/start' }
üí¨ Processing message: { chatId: 123456, text: '/help' }
```

–í—Å–µ –∫–æ–º–∞–Ω–¥—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- `/mysubscriptions` ‚Üí –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥—Ä—É–≥–∏—Ö –∫–æ–º–∞–Ω–¥
- `/start` –ø–æ—Å–ª–µ ‚Üí –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–≥ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–±–æ—Ç—É

### ‚úÖ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- `/mysubscriptions` ‚Üí –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç, –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É
- `/start` –ø–æ—Å–ª–µ ‚Üí –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
- –í—Å–µ –∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
- –ù–∏–∫–∞–∫–∏—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

## üîß Technical Details

**–§–∞–π–ª:** `app/api/webhook/route.ts`
**–°—Ç—Ä–æ–∫–∞:** 227
**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –£–¥–∞–ª–µ–Ω `return`

## üéâ –ò—Ç–æ–≥

**–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞!** –¢–µ–ø–µ—Ä—å –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤ –ª—é–±–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.